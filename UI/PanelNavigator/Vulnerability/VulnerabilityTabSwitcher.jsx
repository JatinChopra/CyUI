import React, { useState, useEffect } from "react";
import { useDispatch } from "react-redux";
import { setSelectedTab } from "./slices/tabsSlice";
import { useSelector } from "react-redux";
import axios from "axios";
import { Box, Button } from "@mui/material";

const tabs = ["All", "New", "Triage", "Duplicate", "Retest", "Resolve", "Bin"];

const ActiveTab = ({ text, index, quantity = 10, dispatch }) => {
  return (
    <Button
      className=" h-full pt-2 capitalize text-white border-b-2 border-solid border-white text-lg px-8 font-bold rounded-none hover:bg-transparent "
      onClick={() => {
        dispatch(setSelectedTab(index));
      }}
    >
      {text} ({quantity})
    </Button>
  );
};

export const VulnerabilitiesTabSwitcher = ({ active }) => {
  const selectedTab = useSelector((state) => state.tabs);
  const data = useSelector((state) => state.vulnerabilities);
  const dispatch = useDispatch();
  let [tabsQuant, setTabsQuant] = useState({
    All: 0,
    New: 0,
    Triage: 0,
    Duplicate: 0,
    Retest: 0,
    Resolve: 0,
    Bin: 0,
  });

  useEffect(() => {
    axios
      .get("./UI/PanelNavigator/Vulnerability/data.json")
      .then((response) => {
        for (let i = 0; i < 2; i++) {
          if (data) {
            setTabsQuant((current) => {
              current = {};
              return {
                All: 0,
                New: 0,
                Triage: 0,
                Duplicate: 0,
                Informative: 0,
                Retest: 0,
                Resolve: 0,
                Bin: 0,
              };
            });
            let Counter = 0;
            response.data.forEach((item) => {
              console.log("Counter : ", Counter);
              Counter = Counter + 1;
              setTabsQuant((current) => {
                console.log("old => ", item.status, current[item.status]);
                current[item.status] += 1;
                current["All"] += 1;
                console.log("new => ", item.status, current[item.status]);
                return current;
              });
            });
            console.log("Quant", data);
            console.log(tabsQuant);

            console.log("finally : ", tabsQuant);
          }
        }
        console.log(response.data);
      });
  }, []);

  return (
    <Box className="flex  gap-0 h-14 items-center drop-shadow-2xl  border-b-2 border-solid border-[#23272B]">
      {tabs.map((item, index) => {
        return (
          <React.Fragment key={index}>
            {selectedTab === index ? (
              <>
                <ActiveTab
                  text={item}
                  index={index}
                  quantity={tabsQuant[item]}
                  dispatch={dispatch}
                />
              </>
            ) : (
              <>
                <Button
                  className="capitalize text-[#97999B] text-lg px-8 hover:text-white hover:bg-transparent rounded-none"
                  onClick={() => {
                    dispatch(setSelectedTab(index));
                  }}
                >
                  {item} ({tabsQuant[item]})
                </Button>
              </>
            )}
          </React.Fragment>
        );
      })}
    </Box>
  );
};
